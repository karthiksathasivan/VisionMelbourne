@model VisionMelbourneV3.Models.DetailedLocation
@{
    ViewBag.Title = Model.Location;
    string tolocation = Model.Location;
    DateTime fulldate = (DateTime)Model.Date;
    TimeSpan fulltime = (TimeSpan)fulldate.TimeOfDay;
    string date = fulldate.Date.ToString("dd/MM/yyyy");
    string time = fulldate.TimeOfDay.ToString(@"hh\:mm");
}


<link href="~/Content/Site.css" rel="stylesheet" />
<link href="~/Content/style.css" rel="stylesheet" />

<body data-gr-c-s-loaded="true" rlt="1" style="" onload="initMap()">

    <div>

        <div class="page-header">
            <div class="container">
                <div class="breadcrumbs">
                    <ul class="list-unstyled">
                        <li><a href="/">Home</a></li>
                        <li>@Model.Location</li>
                    </ul>
                </div> <!-- end .breadcrumbs -->
            </div> <!-- end .container -->
        </div> <!-- end .page-header -->

        <div class="page-title small" style="background-image: url('../images/background15.jpg');">
            <div class="inner small">
                <h2>See more details about @Model.Location</h2>
            </div> <!-- end .inner -->
        </div> <!-- end .page-title -->

        <div class="section boxed-section light shop-details">
            <div class="inner">
                <div class="container">
                    <div class="box">
                        <div class="row">
                            @using (Html.BeginForm("AnyLocationDetails", "UserPlans"))
                            {
                                <div class="row searchform">
                                    <div class="col-md-8">
                                        <label for="FLocation">* Date and Time</label>
                                        <input id="Date" type="datetime" name="Date" class="date-container" value=@Model.Date placeholder="@date,@time" onfocus="this.placeholder=''" onblur="this.placeholder =@date,@time" style="border:solid" />
                                        <button><i class="fa fa-calendar"></i></button>
                                        <br />
                                        <input name="date" hidden id="detailsDate" type="text" value=@Model.Date />
                                        @Html.Hidden("location",Model.Location)
                                        @Html.Hidden("lat",Model.Latitude)
                                        @Html.Hidden("lon",Model.Longitude)
                                        
                                    </div>
                                    <div class="col-md-4">
                                        <input type="submit" value="Update Details" class="button" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="blog-post gallery product-gallery">
                                        <div class="blog-gallery owl-carousel owl-theme owl-loaded">
                                            <div id='map' style='width: 100%; height: 600px;'></div>
                                        </div> <!-- end .blog-gallery -->
                                        <br />
                                        <div style="text-align:center;"><button type="button" class="button" onclick="redirectToMaps();">get directions</button></div>
                                        <br />
                                    </div> <!-- end .blog-post -->
                                </div> <!-- end col-md-6 -->

                                <div class="col-md-6">

                                    <div class="row">
                                        <div class="col-md-3">
                                            <b>Place</b>
                                        </div>
                                        <div class="col-md-9">
                                            <div style="text-align:center">
                                                @Model.Location
                                            </div>
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row">
                                        <div class="col-md-3">
                                            <b>Date</b>
                                        </div>
                                        <div class="col-md-9">
                                            <div style="text-align:center">
                                                @date
                                            </div>
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row">
                                        <div class="col-md-3">
                                            <b>Time </b>
                                        </div>
                                        <div class="col-md-9">
                                            <div style="text-align:center">
                                                @time
                                            </div>
                                        </div>
                                    </div>
                                    <br />
                                    <div class="row">
                                        <div class="col-md-3">
                                            <b>Pedestrian Traffic  </b>
                                        </div>
                                        <div class="col-md-9">
                                            @if (Convert.ToInt32(Model.PeopleCount) == 0)
                                            {
                                                <div style="text-align:center">
                                                    <i class="glyphicon glyphicon-ban-circle"></i>
                                                    <p>Sorry no info found!</p>
                                                </div>
                                            }
                                            @if (Convert.ToInt32(Model.PeopleCount) <= 200 && Convert.ToInt32(Model.PeopleCount) > 0)
                                            {
                                                <div style="text-align:center">
                                                    <i class="glyphicon glyphicon-user"></i> <i class="glyphicon glyphicon-user"></i>
                                                    <p>Free Street!</p>
                                                </div>

                                            }

                                            @if (Convert.ToInt32(Model.PeopleCount) <= 400 && Convert.ToInt32(Model.PeopleCount) > 200)
                                            {
                                                <div style="text-align:center">
                                                    <i class="glyphicon glyphicon-user"></i> <i class="glyphicon glyphicon-user"></i>
                                                    <i class="glyphicon glyphicon-user"></i> <i class="glyphicon glyphicon-user"></i>
                                                    <p>Busy street!</p>
                                                </div>
                                            }
                                            @if (Convert.ToInt32(Model.PeopleCount) > 400)
                                            {
                                                <div style="text-align:center">
                                                    <i class="glyphicon glyphicon-user"></i> <i class="glyphicon glyphicon-user"></i>
                                                    <i class="glyphicon glyphicon-user"></i> <i class="glyphicon glyphicon-user"></i>
                                                    <i class="glyphicon glyphicon-user"></i> <i class="glyphicon glyphicon-user"></i>
                                                    <p>Crowder Than Usual!</p>
                                                </div>
                                            }

                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <b>Accessibility Level  </b>
                                        </div>
                                        <div class="col-md-9">
                                            @if (Convert.ToInt32(Model.AccessibilityRating) == 0)
                                            {
                                                <div style="text-align:center">
                                                    <i class="glyphicon glyphicon-ban-circle"></i>
                                                    <p>Sorry no Accessibility info found!</p>
                                                </div>
                                            }
                                            @if (Convert.ToInt32(Model.AccessibilityRating) == 1)
                                            {
                                                <div style="text-align:center">
                                                    <img src="~/images/LowAccessibility.png" />
                                                    <p>Low Level Accessibility</p>
                                                </div>
                                            }

                                            @if (Convert.ToInt32(Model.AccessibilityRating) == 2)
                                            {
                                                <div style="text-align:center">
                                                    <img src="~/images/MediumAccessibility.png" />
                                                    <p>Moderate Level Accessibility</p>
                                                </div>
                                            }
                                            @if (Convert.ToInt32(Model.AccessibilityRating) == 3)
                                            {
                                                <div style="text-align:center">
                                                    <img src="~/images/HighAccessibility.png" />
                                                    <p>High Level Accessibility</p>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                    <br />
                                </div> <!-- end col-md-6 -->
                            }
                            @using (Html.BeginForm("NewPlan", "UserPlans"))
                            {
                                <div class="searchform" style="text-align:center">
                                    <label for="CLocation">Like to checkout this Place? Add to your Planner.</label>
                                </div>
                                @Html.Hidden("location", tolocation)
                                <input hidden type="text" name="lat" value=@Model.Latitude />
                                <input hidden type="text" name="lon" value=@Model.Longitude />
                                <input id="plannedDate" hidden type="text" name="plandate" value=@Model.Date />
                                <input id="plannedTime" hidden type="text" name="time" value="@Model.Time" />
                                <div class="row">

                                    <div style="text-align:center">
                                        <input type="submit" value="Add to Plan" class="button" />
                                    </div>
                                </div>
                            }
                        </div> <!-- end .row -->
                    </div> <!-- end .box -->
                </div> <!-- end .container -->
            </div> <!-- end .inner -->
        </div> <!-- end .section -->



        <hr>
    </div>
</body>


<script>
    var scenter = "";
    var address = "@Model.Location";
    var latit = @Model.Latitude;
    var lon = @Model.Longitude;
    var currentLocation = "";
    function initMap() {
        var geocoder = new google.maps.Geocoder();
        var infowindow = new google.maps.InfoWindow();
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 16,
            center: { lat: latit, lng: lon },
            mapTypeControl: true,
            mapTypeControlOptions: {
                style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                position: google.maps.ControlPosition.BOTTOM_CENTER
            },
            zoomControl: true,
            zoomControlOptions: {
                position: google.maps.ControlPosition.LEFT_CENTER
            },
            scaleControl: true,
            streetViewControl: true,
            streetViewControlOptions: {
                position: google.maps.ControlPosition.LEFT_BOTTOM
            },
            fullscreenControl: true,
            fullscreenControlOptions: {
                position: google.maps.ControlPosition.RIGHT_BOTTOM
            }
        });


        var marker = new google.maps.Marker({
            map: map,
            position: { lat: latit, lng: lon }
        });

        google.maps.event.addListener(marker, 'click', function () {
            infowindow.setContent("@tolocation");
            infowindow.open(map, this);
        });

    }

    var cityBounds = new google.maps.LatLngBounds(
        new google.maps.LatLng(-38.067807865, 144.5148742199),
        new google.maps.LatLng(-37.5687831234, 145.4157531261));

    var options = {
        bounds: cityBounds,
        componentRestrictions: { country: "au" }
    };
    var input = document.getElementById('autocomplete');
    var autocomplete = new google.maps.places.Autocomplete(input, options);
    autocomplete.addListener('place_changed', function () {
        var place = autocomplete.getPlace();
    });

    function getCurrentLocation() {
        var options = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0
        };

        function success(pos) {
            currentLocation = pos.coords;
            var latlng = { lat: parseFloat(currentLocation.latitude), lng: parseFloat(currentLocation.longitude) };
            var geocoder = new google.maps.Geocoder;
            geocoder.geocode({ 'location': latlng }, function (results, status) {
                if (status === 'OK') {
                    if (results[0]) {
                        document.getElementById('autocomplete').value = results[0].formatted_address;
                    } else {
                        window.alert('No results found');
                    }
                } else {
                    window.alert('Geocoder failed due to: ' + status);
                }
            });
        }

        function error(err) {
            console.warn(`ERROR(${err.code}): ${err.message}`);
        }

        navigator.geolocation.getCurrentPosition(success, error, options);
    }

    function returnMapUrl(dlat, dlng) {
        return "https://www.google.com/maps/dir/?api=1&origin=" + dlat + ',' + dlng + "&destination=" + latit + ',' + lon ;
    }
    function redirectToMaps() {
        getCurrentLocation();
        window.open(returnMapUrl(currentLocation.latitude, currentLocation.longitude), '_blank');
    }

</script>
<script>
    //var currentLocation;
    //var cityBounds = new google.maps.LatLngBounds(
    //    new google.maps.LatLng(-38.067807865, 144.5148742199),
    //    new google.maps.LatLng(-37.5687831234, 145.4157531261));

    //var options = {
    //    bounds: cityBounds,
    //    componentRestrictions: { country: "au" }
    //};
    //var input = document.getElementById('autocomplete');
    //var autocomplete = new google.maps.places.Autocomplete(input, options);
    //autocomplete.addListener('place_changed', function () {
    //    var place = autocomplete.getPlace();
    //});

    //function getCurrentLocation() {
    //    var options = {
    //        enableHighAccuracy: true,
    //        timeout: 5000,
    //        maximumAge: 0
    //    };

    //    function success(pos) {
    //        currentLocation = pos.coords;
    //        var latlng = { lat: parseFloat(currentLocation.latitude), lng: parseFloat(currentLocation.longitude) };
    //        var geocoder = new google.maps.Geocoder;
    //        geocoder.geocode({ 'location': latlng }, function (results, status) {
    //            if (status === 'OK') {
    //                if (results[0]) {
    //                    document.getElementById('autocomplete').value = results[0].formatted_address;
    //                    console.log(results[0].formatted_address);
    //                } else {
    //                    window.alert('No results found');
    //                }
    //            } else {
    //                window.alert('Geocoder failed due to: ' + status);
    //            }
    //        });
    //    }

    //    function error(err) {
    //        console.warn(`ERROR(${err.code}): ${err.message}`);
    //    }

    //    navigator.geolocation.getCurrentPosition(success, error, options);
    //}
</script>
<script type="text/javascript">
    $(function () {
        $('#Date').datetimepicker({
            minDate: new Date(),
        }).on('dp.change', function (e) {
            document.getElementById("plannedDate").value = e.date.format("MM/DD/YYYY");
            document.getElementById("plannedTime").value = e.date.format("HH:mm:ss");
            document.getElementById("detailsDate").value = e.date.format("MM/DD/YYYY HH:mm:ss");
        });
    });

</script>